import { Checkbox, Box, List, ListItem } from "@mui/material";
import * as React from "react";
import { FC } from "react";
import { Link } from "react-router-dom";

import {
  EntryRetrieveValue,
  EntryRetrieveValueAsObject,
  EntryRetrieveValueAsObjectSchema,
} from "../../apiclient/autogenerated";

import { groupsPath, rolePath, entryDetailsPath } from "Routes";
import { DjangoContext } from "utils/DjangoContext";

const ElemBool: FC<{ attrValue: string | boolean }> = ({ attrValue }) => {
  const checkd =
    typeof attrValue === "string"
      ? attrValue.toLowerCase() === "true"
      : attrValue;
  return <Checkbox checked={checkd} disabled sx={{ p: "0px" }} />;
};

const ElemString: FC<{ attrValue: string }> = ({ attrValue }) => {
  return (
    <Box>
      {
        // Separate line breaks with tags
        attrValue?.split("\n").map((line, key) => (
          <Box key={key}>{line}</Box>
        ))
      }
    </Box>
  );
};

const ElemObject: FC<{
  attrValue: EntryRetrieveValueAsObject;
}> = ({ attrValue }) => {
  return attrValue ? (
    <Box
      component={Link}
      to={entryDetailsPath(attrValue.schema?.id ?? 0, attrValue.id)}
    >
      {attrValue.name}
    </Box>
  ) : (
    <Box />
  );
};

const ElemNamedObject: FC<{
  attrValue: {
    [key: string]: EntryRetrieveValueAsObject;
  };
}> = ({ attrValue }) => {
  const key = Object.keys(attrValue)[0];
  return attrValue ? (
    <Box display="flex">
      <Box>{key}: </Box>
      {attrValue[key] ? (
        <Box
          component={Link}
          to={entryDetailsPath(
            attrValue[key].schema?.id ?? 0,
            attrValue[key].id
          )}
        >
          {attrValue[key].name}
        </Box>
      ) : (
        <Box />
      )}
    </Box>
  ) : (
    <Box />
  );
};

const ElemGroup: FC<{ attrValue: EntryRetrieveValueAsObjectSchema }> = ({
  attrValue,
}) => {
  return attrValue ? (
    <Box component={Link} to={groupsPath}>
      {attrValue.name}
    </Box>
  ) : (
    <Box />
  );
};

const ElemRole: FC<{ attrValue: EntryRetrieveValueAsObjectSchema }> = ({
  attrValue,
}) => {
  return attrValue ? (
    <Box component={Link} to={rolePath(attrValue.id)}>
      {attrValue.name}
    </Box>
  ) : (
    <Box />
  );
};

interface Props {
  attrInfo: {
    type: number;
    value: EntryRetrieveValue;
  };
}

export const AttributeValue: FC<Props> = ({ attrInfo }) => {
  const djangoContext = DjangoContext.getInstance();

  switch (attrInfo.type) {
    case djangoContext.attrTypeValue.object:
      return (
        <List>
          <ListItem>
            <ElemObject attrValue={attrInfo.value.asObject} />
          </ListItem>
        </List>
      );

    case djangoContext.attrTypeValue.string:
    case djangoContext.attrTypeValue.text:
    case djangoContext.attrTypeValue.date:
      return (
        <List>
          <ListItem>
            <ElemString attrValue={attrInfo.value.asString} />
          </ListItem>
        </List>
      );

    case djangoContext.attrTypeValue.boolean:
      return (
        <List>
          <ListItem>
            <ElemBool attrValue={attrInfo.value.asBoolean} />
          </ListItem>
        </List>
      );

    case djangoContext.attrTypeValue.named_object:
      return (
        <List>
          <ListItem>
            <ElemNamedObject attrValue={attrInfo.value.asNamedObject} />
          </ListItem>
        </List>
      );

    case djangoContext.attrTypeValue.group:
      return (
        <List>
          <ListItem>
            <ElemGroup attrValue={attrInfo.value.asGroup} />
          </ListItem>
        </List>
      );

    case djangoContext.attrTypeValue.role:
      return (
        <List>
          <ListItem>
            <ElemRole attrValue={attrInfo.value.asRole} />
          </ListItem>
        </List>
      );

    case djangoContext.attrTypeValue.array_object:
      return (
        <List>
          {attrInfo.value.asArrayObject.map((info, n) => (
            <ListItem key={n}>
              <ElemObject attrValue={info} />
            </ListItem>
          ))}
        </List>
      );

    case djangoContext.attrTypeValue.array_string:
      return (
        <List>
          {attrInfo.value.asArrayString.map((info, n) => (
            <ListItem key={n}>
              <ElemString attrValue={info} />
            </ListItem>
          ))}
        </List>
      );

    case djangoContext.attrTypeValue.array_named_object:
      return (
        <List>
          {attrInfo.value.asArrayNamedObject.map((info, n) => (
            <ListItem key={n}>
              <ElemNamedObject attrValue={info} />
            </ListItem>
          ))}
        </List>
      );

    case djangoContext.attrTypeValue.array_group:
      return (
        <List>
          {attrInfo.value.asArrayGroup.map((info, n) => (
            <ListItem key={n}>
              <ElemGroup attrValue={info} />
            </ListItem>
          ))}
        </List>
      );

    case djangoContext.attrTypeValue.array_role:
      return (
        <List>
          {attrInfo.value.asArrayRole.map((info, n) => (
            <ListItem key={n}>
              <ElemRole attrValue={info} />
            </ListItem>
          ))}
        </List>
      );
  }
};
